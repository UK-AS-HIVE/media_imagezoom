<!--
  Functions add simple custom controls to OpenLayers maps in Drupal,
  allowing to select one base layer and one overlay in dropdowns,
  and scrub transparency between them
-->  
<script language="javascript">
jQuery(document).ready(function()
{
  var map = Drupal.settings.openlayers.maps[jQuery('.openlayers-map').attr('id')];
  var baseSelect = '<select class="baseLayerSelect">';
  var overlaySelect = '<select class="overlayLayerSelect">';
  for (var i=0; i<map[0].layers.length; ++i)
  {
    if (map[0].layers[i].isBaseLayer)
      baseSelect += '<option value="' + i + '">' + map[0].layers[i].title + '</option>';
    else
      overlaySelect += '<option value="' + i + '">' + map[0].layers[i].title + '</option>';
  }
  baseSelect += '</select>';
  overlaySelect += '</select>';
  jQuery('.openlayers-map').parents('.view').prepend(overlaySelect);
  jQuery('.openlayers-map').parents('.view').prepend(baseSelect);
  jQuery('select.baseLayerSelect').change(function() {
    var map = Drupal.settings.openlayers.maps[jQuery('.openlayers-map').attr('id')];
    map[0].setBaseLayer(map[0].layers[jQuery(this).val()]);
  });
  jQuery('select.overlayLayerSelect').change(function() {
    var map = Drupal.settings.openlayers.maps[jQuery('.openlayers-map').attr('id')];
    var selectedLayerIndex = jQuery(this).val();
    for (var i=0; i<map[0].layers.length; ++i)
    {
      if (!map[0].layers[i].isBaseLayer)
        map[0].layers[i].setVisibility(i == selectedLayerIndex);
    }
  });
});

function setLayerOpacity(opacity)
{
  var map = Drupal.settings.openlayers.maps[jQuery('.openlayers-map').attr('id')];
  for (var i = 0; i<map[0].layers.length; ++i)
  {
    if (!map[0].layers[i].isBaseLayer)
      map[0].layers[i].setOpacity(opacity);
  }
}
</script>

<a onclick="javascript:setLayerOpacity(0.0);">0.0</a> | <a onclick="javascript:setLayerOpacity(0.25);">0.25</a> | <a onclick="javascript:setLayerOpacity(0.5);">0.5</a> | <a onclick="javascript:setLayerOpacity(0.75);">0.75</a> | <a onclick="javascript:setLayerOpacity(1.0);">1.0</a>

